# アナリティクス機能セットアップガイド

## 概要

このアナリティクス機能は、Ripre告知文チェックシステムの使用状況を管理者が監視・分析するための機能です。

## 機能一覧

### 1. ユーザー管理
- 総ユーザー数の表示
- ユーザー別レポート生成数（グラフ表示）
- ユーザー一覧と最終活動日時

### 2. レポート統計
- 日別レポート生成数の推移
- 平均審査スコアの推移
- 総レポート数

### 3. ログイン履歴
- 日別ログイン回数
- ユニークユーザー数
- 累計ログイン回数

### 4. 使用統計
- 審査機能の使用回数（累計・日別）
- ユーザー別使用頻度
- 評価済みレポート数

## セットアップ手順

### 1. データベーススキーマの作成

Supabaseで以下のSQLを実行してください：

```sql
-- supabase-admin-schema.sql の内容を実行
```

### 2. 管理者ユーザーの設定

以下のコマンドで管理者ユーザーを設定します：

```bash
npm run setup-admin your-email@example.com
```

または、直接Supabaseで以下のSQLを実行：

```sql
INSERT INTO admin_users (user_email, user_name, is_admin) 
VALUES ('your-email@example.com', 'あなたの名前', true)
ON CONFLICT (user_email) DO UPDATE SET is_admin = true;
```

### 3. 環境変数の確認

`.env.local`に以下の環境変数が設定されていることを確認：

```
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
```

## 使用方法

1. 管理者権限を持つユーザーでログイン
2. ダッシュボードの「アナリティクス」タブをクリック
3. 各種統計データを確認

## 権限管理

- アナリティクス機能は管理者権限を持つユーザーのみが閲覧可能
- 管理者権限は`admin_users`テーブルで管理
- 非管理者ユーザーには「アナリティクス」タブが表示されない

## データの自動収集

以下のデータが自動的に収集されます：

- **ログイン履歴**: ユーザーがログインするたびに記録
- **レポート生成履歴**: 審査機能を使用するたびに記録
- **ユーザー評価**: ユーザーがAIの審査結果を評価した際に記録

## トラブルシューティング

### アナリティクスタブが表示されない
- 管理者権限が正しく設定されているか確認
- ログアウト・ログインを試行

### データが表示されない
- Supabaseの接続設定を確認
- ブラウザの開発者ツールでAPIエラーを確認

### 権限エラーが発生する
- `admin_users`テーブルのRLSポリシーを確認
- 管理者権限が正しく設定されているか確認

## セキュリティ考慮事項

- 管理者権限の付与は慎重に行う
- 定期的に管理者ユーザーの見直しを実施
- ログイン履歴にはIPアドレスも記録されるため、プライバシーに配慮

## 今後の拡張予定

- エクスポート機能
- より詳細な分析機能
- アラート機能
- レポートの自動生成